<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Помощь: Сервер базы данных</title>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<a href="index.html">Оглавление</a>
<h1 align="center">Настройка на другой сервер базы данных</h1>
<p>
По умолчанию система Arigato CMS работает с сервером базы данных MySQL. Но при необходимости можно настроить систему и на другой тип сервера. Это возможно благодаря тому, что все функции работы с базой данных вынесены в отдельный модуль: <b>db.php</b>. Для настройки на другую базу данных нужно изменить все функции модуля таким образом, что бы они работали с нужной нам базой. Ниже приведен перечень всех функций модуля с кратким пояснением.
</p><p>
<b>function db_error ($query = '')</b> – обработчик ошибок запросов к базе данных. При отладки работы модуля может данная функция оказаться очень полезной, однако в конечном варианте ошибки запросов лучше не выводить, а просто подавлять.
</p><p>
<b>function db_connect()</b> – подключение к базе данных. Параметры подключения содержатся в файле <b>conf.php</b> и записываются в хеш-массив $INFO: <b>$INFO['db_server']</b> – сервер базы данных; <b>$INFO['db_login']</b> – логин пользователя базы данных; <b>$INFO['db_password']</b> – пароль доступа к базе данных; <b>$INFO['db_database']</b> – название базы данных.
</p><p>
<b>function db_query ($query)</b> – запрос к базе данных. При модификации данной функции надо учесть, что в MySQL активно используется конструкция <b>LIMIT</b>, которая не является стандартной для языка SQL. В других серверах базы данных LIMIT может отсутствовать или иметь другой синтаксис. Поэтому, прежде чем выполнять запрос, нужно обработать ситуацию, когда в запросе есть LIMIT и модифицировать запрос так, что бы он был корректным для выбранного типа базы данных. Например, в форумах phpBB2 в папке db содержатся модули работы с различными базами данных, там можно посмотреть, как обработать запросы с LIMIT при использовании баз данных, отличных от MySQL.
</p><p>
<b>function db_free_result ($result)</b> – освобождение памяти от запроса. Данная функция должна очищать результат запроса для освобождения памяти. Однако ее можно не модифицировать, а оставить пустой, так как при завершении PHP-скрипта память будет освобождена автоматически.
</p><p>
<b>function db_fetch_assoc ($result)</b> – получение результата в виде хеш-массива. Затруднений с модификацией не должно возникать.
</p><p>
<b>function db_fetch_row ($result)</b> – получение результата в виде индексного массива. То же модифицируется без проблем.
</p><p>
<b>function db_num_rows ($result)</b> – получение количества записей в результате.
</p><p>
<b>function db_insert_id()</b> – получение первичного ключа последнего запроса добавления новой записи в таблицу базы данных.
</p><p>
<b>function db_affected_rows()</b> – получение количества обновленных записей при использовании запроса UPDATE.
</p><p>
Кроме непосредственной работы с базой данных, модуль db.php осуществляет подсчет количества запросов (<b>$INFO['db_querys']</b>) и времени, затраченного на работу сервера базы данных (<b>$INFO['db_time']</b>).
</p><p>
Надо учесть, что скрипт установки системы <b>install.php</b> не использует модуль db.php, а работает с базой данных напрямую. Поэтому, для полного перехода на новый тип базы данных, нужно модифицировать и его.
</p>
</body>
</html>